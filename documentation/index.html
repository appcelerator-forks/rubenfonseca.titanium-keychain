<!DOCTYPE html>  
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>index</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
/* 
   This document has been created with Marked.app <http://markedapp.com>, Copyright 2011 Brett Terpstra
   Please leave this notice in place, along with any additional credits below.
   ---------------------------------------------------------------
   Title: GitHub
   Author: Brett Terpstra
   Description: Github README style. Includes theme for Pygmentized code blocks.
*/
html,body{color:black}*{margin:0;padding:0}body{font:13.34px helvetica,arial,freesans,clean,sans-serif;-webkit-font-smoothing:antialiased;line-height:1.4;padding:3px;background:#fff;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px}p{margin:1em 0}a{color:#4183c4;text-decoration:none}#wrapper{background-color:#fff;border:3px solid #eee!important;padding:0 30px;margin:15px}#wrapper{font-size:14px;line-height:1.6}#wrapper>*:first-child{margin-top:0!important}#wrapper>*:last-child{margin-bottom:0!important}h1,h2,h3,h4,h5,h6{margin:0;padding:0}h1{margin:15px 0;padding-bottom:2px;font-size:24px;border-bottom:1px solid #eee}h2{margin:20px 0 10px 0;font-size:18px}h3{margin:20px 0 10px 0;padding-bottom:2px;font-size:14px;border-bottom:1px solid #ddd}h4{font-size:14px;line-height:26px;padding:18px 0 4px;font-weight:bold;text-transform:uppercase}h5{font-size:13px;line-height:26px;padding:14px 0 0;font-weight:bold;text-transform:uppercase}h6{color:#666;font-size:14px;line-height:26px;padding:18px 0 0;font-weight:normal;font-variant:italic}hr{background:transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;border:0 none;color:#ccc;height:4px;margin:20px 0;padding:0}#wrapper>h2:first-child,#wrapper>h1:first-child,#wrapper>h1:first-child+h2{border:0;margin:0;padding:0}#wrapper>h3:first-child,#wrapper>h4:first-child,#wrapper>h5:first-child,#wrapper>h6:first-child{margin:0;padding:0}h4+p,h5+p,h6+p{margin-top:0}li p.first{display:inline-block}ul,ol{margin:15px 0 15px 25px}ul li,ol li{margin-top:7px;margin-bottom:7px}ul li>*:last-child,ol li>*:last-child{margin-bottom:0}ul li>*:first-child,ol li>*:first-child{margin-top:0}#wrapper>ul,#wrapper>ol{margin-top:21px;margin-left:36px}dl{margin:0;padding:20px 0 0}dl dt{font-size:14px;font-weight:bold;line-height:normal;margin:0;padding:20px 0 0}dl dt:first-child{padding:0}dl dd{font-size:13px;margin:0;padding:3px 0 0}blockquote{margin:14px 0;border-left:4px solid #ddd;padding-left:11px;color:#555}table{border-collapse:collapse;margin:20px 0 0;padding:0}table tr{border-top:1px solid #ccc;background-color:#fff;margin:0;padding:0}table tr:nth-child(2n){background-color:#f8f8f8}table tr th,table tr td{border:1px solid #ccc;text-align:left;margin:0;padding:6px 13px}img{max-width:100%;height:auto}code,tt{margin:0 2px;padding:2px 5px;white-space:nowrap;border:1px solid #ccc;background-color:#f8f8f8;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px;font-size:12px}pre>code{margin:0;padding:0;white-space:pre;border:0;background:transparent;font-size:13px}.highlight pre,pre{background-color:#f8f8f8;border:1px solid #ccc;font-size:13px;line-height:19px;overflow:auto;padding:6px 10px;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px}#wrapper>pre,#wrapper>div.highlight{margin:10px 0 0}pre code,pre tt{background-color:transparent;border:0}#wrapper{background-color:#fff;border:1px solid #cacaca;padding:30px}.poetry pre{font-family:Georgia,Garamond,serif!important;font-style:italic;font-size:110%!important;line-height:1.6em;display:block;margin-left:1em}.poetry pre code{font-family:Georgia,Garamond,serif!important}sup,sub,a.footnote{font-size:1.4ex;height:0;line-height:1;vertical-align:super;position:relative}sub{vertical-align:sub;top:-1px}@media print{body{background:#fff}img,pre,blockquote,table,figure{page-break-inside:avoid}#wrapper{background:#fff;border:0}code{background-color:#fff;color:#444!important;padding:0 .2em;border:1px solid #dedede}pre code{background-color:#fff!important;overflow:visible}pre{background:#fff}}@media screen{body.inverted,.inverted #wrapper,.inverted hr .inverted p,.inverted td,.inverted li,.inverted h1,.inverted h2,.inverted h3,.inverted h4,.inverted h5,.inverted h6,.inverted th,.inverted .math,.inverted caption,.inverted dd,.inverted dt,.inverted blockquote{color:#eee!important;border-color:#555}.inverted td,.inverted th{background:#333}.inverted pre,.inverted code,.inverted tt{background:#444!important}.inverted h2{border-color:#555}.inverted hr{border-color:#777;border-width:1px!important}::selection{background:rgba(157,193,200,.5)}h1::selection{background-color:rgba(45,156,208,.3)}h2::selection{background-color:rgba(90,182,224,.3)}h3::selection,h4::selection,h5::selection,h6::selection,li::selection,ol::selection{background-color:rgba(133,201,232,.3)}code::selection{background-color:rgba(0,0,0,.7);color:#eee}code span::selection{background-color:rgba(0,0,0,.7)!important;color:#eee!important}a::selection{background-color:rgba(255,230,102,.2)}.inverted a::selection{background-color:rgba(255,230,102,.6)}td::selection,th::selection,caption::selection{background-color:rgba(180,237,95,.5)}.inverted{background:#0b2531}.inverted #wrapper,.inverted{background:rgba(37,42,42,1)}.inverted a{color:rgba(172,209,213,1)}}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#800080;font-weight:bold}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kn{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:#008080}.highlight .nb{color:#0086b3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:#008080}.highlight .ni{color:#800080}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:#000080}.highlight .nv{color:#008080}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:#008080}.highlight .vg{color:#008080}.highlight .vi{color:#008080}.highlight .il{color:#099}.highlight .gc{color:#999;background-color:#eaf2f5}.type-csharp .highlight .k{color:#00F}.type-csharp .highlight .kt{color:#00F}.type-csharp .highlight .nf{color:#000;font-weight:normal}.type-csharp .highlight .nc{color:#2b91af}.type-csharp .highlight .nn{color:#000}.type-csharp .highlight .s{color:#a31515}.type-csharp .highlight .sc{color:#a31515}
</style>

</head>
<body class="normal">
  <div id="wrapper">
      <h1 id="keychainmodule">keychain Module</h1>

<h2 id="description">Description</h2>

<p>This Titanium Module allows you to interact with the iOS Keychain in
a tidy and simple way. This allows you to securely store and retrieve login
information for a specific service and account.</p>

<h2 id="installation">Installation</h2>

<p><a href="">http://wiki.appcelerator.org/display/tis/Using+Titanium+Modules</a></p>

<h2 id="changelog">Changelog</h2>

<p>See <a href="changelog.html">here</a></p>

<h2 id="accessingthekeychainmodule">Accessing the keychain Module</h2>

<p>To access this module from JavaScript, you would do the following:</p>

<pre><code>var keychain = require(&quot;com.0x82.key.chain&quot;);
</code></pre>

<p>The keychain variable is a reference to the Module object. </p>

<h2 id="reference">Reference</h2>

<h3 id="keychain.getpasswordforserviceserviceaccountoptions">keychain.getPasswordForService(service, account, [options])</h3>

<p>This method gets a password from the iOS keychain. Both parameters are required</p>

<p>service[string]: the name of the service you are getting the password
account[string]: the account identifier
options[object, optional]: see section &#8220;advanced keychain options&#8221; bellow</p>

<p>This method returns <em>null</em> if there are no login information for the parameters.</p>

<p>Example:</p>

<pre><code>var pass = keychain.getPasswordForService('twitter', 'root@cpan.org');
</code></pre>

<h3 id="keychain.setpasswordforservicepasswordserviceaccountoptions">keychain.setPasswordForService(password, service, account, [options])</h3>

<p>Stores a password for the service/account pair. All parameters are required,
except for <code>options</code> (see section &#8220;advanced keychain options&#8221; bellow).</p>

<p>Example:</p>

<pre><code>  var passwordField = Ti.UI.createTextField({ ... });

  # then later...
  keychain.setPasswordForService(passwordField.value, 'twitter', 'root@cpan.org');
</code></pre>

<h3 id="keychain.deletepasswordforserviceserviceaccountoptions">keychain.deletePasswordForService(service, account, [options])</h3>

<p>Deletes the password for the service/account pair. Does nothing if there&#8217;s no
login information for that pair.
See &#8220;advanced keychain options&#8221; bellow for the <code>options</code> param.</p>

<p>Example:</p>

<pre><code>var deleteButton = Ti.UI.createButton({ .... })

deleteButton.addEventListener('click', function(e) {
  keychain.deletePasswordForService('twitter', 'root@cpan.org');
  alert('done :)');
});
</code></pre>

<h2 id="usage">Usage</h2>

<p>For a full example, check the examples/app.js file.</p>

<h2 id="advancedkeychainoptions">Advanced Keychain Options</h2>

<p>Since version 2.0 of the module, evey call (get, set, delete) accepts an optional object
at the end, that allows to set specific advanced flags on the iOS Keychain. Specifically,
we support the <code>accesible</code> and <code>access_group</code> options.</p>

<p><strong>VERY VERY IMPORTANT</strong>: since these advanced features requires the presence of a signed app
and a secure hardware device, these advanced options will <strong>not work</strong> on the Simulator. You
need to use a real iOS device to test and use them! Usage of these options on the Simulator
will lead to undefined behaviour.</p>

<h3 id="accessible">Accessible</h3>

<p>Use this option to indicate when your application needs access to the data in a keychain item.
You should choose the most restrictive option that meets your application&#8217;s needs so that iOS
can protect that item to the greatest extent possible.</p>

<p>The available options for the <code>accessible</code> key are:</p>

<ul>
<li><p>keychain.ATTR_ACCESSIBLE_WHEN_UNLOCKED</p>

<blockquote>
<p>The data in the keychain item can be accessed only while the device is
 unlocked by the user. This is recommended for items that need to be accessible
 only while the application is in the foreground. Items with this attribute
 migrate to a new device when using encrypted backups.</p>
</blockquote></li>
<li><p>keychain.ATTR_ACCESSIBLE_WHEN_UNLOCKED_THIS_DEVICE_ONLY</p>

<blockquote>
<p>The data in the keychain item can be accessed only while the device is
unlocked by the user. This is recommended for items that need to be accesible
only while the application is in the foreground. Items with this attribute do
not migrate to a new device or new installation. Thus, after restoring from a
backup, these items will not be present.</p>
</blockquote></li>
<li><p>keychain.ATTR_ACCESSIBLE_AFTER_FIRST_UNLOCK</p>

<blockquote>
<p>The data in the keychain item cannot be accessed after after a restart until
the device has been unlocked once by the user. After the first unlock, the
data remains accessible until the next restart. This is recommended for items
that need to be accessed by background applications. Items with this
attribute migrate to a new device when using encrypted backups.</p>
</blockquote></li>
<li><p>keychain.ATTR_ACCESSIBLE_AFTER_FIRST_UNLOCK_THIS_DEVICE_ONLY</p>

<blockquote>
<p>The data in the keychain item cannot be accessed after after a restart until
the device has been unlocked once by the user. After the first unlock, the
data remains accessible until the next restart. This is recommended for items
that need to be accessed by background applications. Items with this
attribute do not migrate to a new device or new installation. Thus, after
restoring from a backup, these items will not be present.</p>
</blockquote></li>
<li><p>keychain.ATTR_ACCESSIBLE_ALWAYS</p>

<blockquote>
<p>The data in the keychain item can always be accessed regardless of whether
the device is locked. This is not recommended for application use. Items with
this attribute migrate to a new device when using encrypted backups. This is also
the default option.</p>
</blockquote></li>
<li><p>keychain.ATTR_ACCESSIBLE_ALWAYS_THIS_DEVICE_ONLY</p>

<blockquote>
<p>The data in the keychain item can always be accessed regardless of whether
the device is locked. This is not recommended for application use. Items with
this attribute do not migrate to a new device or new installation. Thus,
after restoring from a backup, these items will not be present.</p>
</blockquote></li>
</ul>

<p>Example:</p>

<pre><code>var sharekit = require('com.0x82.sharekit');
sharekit.setPasswordForService('password', 'service', 'account', {
  accessible: sharekit.ATTR_ACCESSIBLE_ALWAYS_THIS_DEVICE_ONLY
});

sharekit.getPasswordForService('service', 'account', {
  accessible: sharekit.ATTR_ACCESSIBLE_ALWAYS_THIS_DEVICE_ONLY
});
</code></pre>

<h3 id="accessgroup">Access Group</h3>

<p>Access groups can be used to share keychain items among two or more
applications. For applications to share a keychain item, the applications must
have a common access group listed in their keychain-access-groups entitlement,
and the application adding the shared item to the keychain must specify this
shared access-group name as the value for this key in the dictionary passed to
the get/set/delete function.</p>

<p>The main pre-requisite for shared keychain access is that all of the applications
have a <em>common bundle seed ID</em>. To be clear what this means, remember that an App ID
consists for two parts:</p>

<pre><code>&lt;bundle seed ID&gt;.&lt;Bundle Identifier&gt;
</code></pre>

<p>The bundle seed ID is a unique (within the App Store) ten character string that is
generated by Apple when you first create an App ID. The bundle identifier is generally set
to be a reverse domain string identifying your app (e.g. <code>com.yourcompany.appName</code>) and is what
you specify in the application <code>Info.plist</code> in Xcode.</p>

<p>So when you want to create an app that can share keychain access with an
existing app you need to make sure that you use the bundle seed ID of the
existing app. You do this when you create the new App ID in the iPhone
Provisioning Portal. Instead of generating a new value you select the existing
value from the list of all your previous bundle seed IDs.</p>

<p>One caveat, whilst you can create a provisioning profile with a wildcard for
the bundle identifier I have never been able to get shared keychain access
working between apps using it. It works fine with fully specified (no wildcard)
identifiers. Since a number of other Apple services such as push notifications
and in-app purchase also have this restriction maybe it should not be a
surprise but I am yet to find this documented for keychain access.</p>

<p>Once you have your provisioning profiles setup with a common bundle seed ID the
rest is pretty easy. The first thing you need to do is register the keychain
access group you want to use. The keychain access group can be named pretty
much anything you want as long as it starts with the bundle seed ID. So for
example if I have two applications as follows:</p>

<ul>
<li>ABC1234DEF.com.useyourloaf.amazingApp1</li>
<li>ABC1234DEF.com.useyourloaf.amazingApp2</li>
</ul>

<p>I could define a common keychain access group as follows:</p>

<ul>
<li>ABC1234DEF.amazingAppFamily</li>
</ul>

<p>To enable this application to access this group you need to add an <code>Entitlements.plist</code>
file to the root of your Titanium Project. Create a new file called <code>Entitlements.plist</code>
and using a text editor, add the following:</p>

<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
    &lt;key&gt;keychain-access-groups&lt;/key&gt;
    &lt;array&gt;
        &lt;string&gt;ABC1234DEF.amazingAppFamily&lt;/string&gt;
    &lt;/array&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>

<p>This same process should be repeated for all apps that share the bundle seed ID
to enable them to access the keychain group. To actually store and retrieve
values from this group requires an additional key on the get/set/delete function call:</p>

<pre><code>var sharekit = require('com.0x82.sharekit');
sharekit.setPasswordForService('password', 'service', 'account', {
  access_group: &quot;ABC1234DEF.amazingAppFamily&quot;
});

sharekit.getPasswordForService('service', 'account', {
  access_group: &quot;ABC1234DEF.amazingAppFamily&quot;
});
</code></pre>

<p>One final comment, using a shared keychain access group does not stop you from
storing values in an applications private keychain as well.</p>

<h2 id="author">Author</h2>

<p>Ruben Fonseca, root (at) cpan (dot) org</p>

<p>You can also find me on <a href="http://github.com/rubenfonseca">github</a> and on my
<a href="http://blog.0x82.com">blog</a></p>

<h2 id="license">License</h2>

<p>This module is licensed under the MIT License. Please see the LICENSE file for
details</p>
    </div>
</body>
</html>